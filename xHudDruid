local panelNombre = "tcSkills"
local panelHud = setupUI([[
OutlineLabel < Label
  height: 25
  background-color: #00000044
  opacity: 0.89
  text-auto-resize: true
  font: verdana-11px-rounded
  anchors.left: parent.left
  $first:
    anchors.top: parent.top
  $!first:
    anchors.top: prev.bottom

Panel
  id: panelHabilidad
  height: 200
  width: 150
  anchors.left: parent.left
  anchors.bottom: parent.bottom
  margin-bottom: 40
  margin-left: 5
]], modules.game_interface.getMapPanel())

function valorConComas(cantidad)
  local formateado = cantidad
  while true do  
    formateado, cambios = string.gsub(formateado, "^(-?%d+)(%d%d%d)", '%1,%2')
    if (cambios == 0) then
      break
    end
  end
  return formateado
end

local expPorHora = 0
local siguienteNivelEn = "00h:00m"

function actualizarExpPorHora()
  if player.expSpeed ~= nil then
    local expPorHoraCalculado = math.floor(player.expSpeed * 3600)
    if expPorHoraCalculado > 0 then
      expPorHora = valorConComas(expPorHoraCalculado)
    end
  end
end

function mostrarExpPorHora()
  local etiqueta = panelHud[1] or UI.createWidget("OutlineLabel", panelHud)
  etiqueta:setId(1)

  etiqueta:setColoredText({
    'Exp/h: ', 'white',
    expPorHora, 'green',
    ' x Hora', 'orange',
    siguienteNivelEn
  })
end

function calcularStamina()
  local stam = stamina()
  local horas = math.floor(stam / 60)
  local minutos = stam % 60
  if minutos < 10 then
    minutos = '0' .. minutos
  end
  local porcentaje = math.floor(100 * stam / (42 * 60))
  return horas.. ':'.. minutos, ' ('..porcentaje..'%)'
end

function mostrarStamina()
  local etiqueta = panelHud[2] or UI.createWidget("OutlineLabel", panelHud)
  etiqueta:setId(2)
  local horas, porcentaje = calcularStamina()

  etiqueta:setColoredText({
    'Stamina: ', 'white',
    horas, 'green',
    porcentaje, 'white'
  })
end

function mostrarNivel()
  local etiqueta = panelHud[3] or UI.createWidget("OutlineLabel", panelHud)
  etiqueta:setId(3)

  local porcentajeActual = player:getLevelPercent()
  local porcentajeFaltante = 100 - porcentajeActual

  etiqueta:setColoredText({
    'Nivel: ', 'white',
    level(), 'green',
    '', porcentajeActual, ' (', 'orange', porcentajeFaltante, '%)', '%)', 'orange'
  })
end

SHIELD = 5
function mostrarShield()
  local etiqueta = panelHud[5] or UI.createWidget("OutlineLabel", panelHud)
  etiqueta:setId(5)

  local porcentajeActual = player:getSkillLevelPercent(SHIELD)
  local porcentajeFaltante = 100 - porcentajeActual

  etiqueta:setColoredText({
    'Shield: ', 'white',
    player:getSkillLevel(SHIELD), 'green',
    '', porcentajeActual, ' (', 'orange', porcentajeFaltante, '%)', '%)', 'orange'
  })
end

function mostrarMagicLevel()
  local etiqueta = panelHud[6] or UI.createWidget("OutlineLabel", panelHud)
  etiqueta:setId(6)

  local porcentajeActual = player:getMagicLevelPercent()
  local porcentajeFaltante = 100 - porcentajeActual

  etiqueta:setColoredText({
    'Magic Lvl: ', 'white',
    player:getMagicLevel(), 'green',
    '', porcentajeActual, ' (', 'orange', porcentajeFaltante, '%)', '%)', 'orange'
  })
end

local checarExpPorHora = macro(5000, 'Muestra Exp Y Skills', function()
  actualizarExpPorHora()
  mostrarExpPorHora()
  mostrarStamina()
  mostrarNivel()
  mostrarShield()
  mostrarMagicLevel()
end)

panelHud:breakAnchors() --editado por Madgenius
panelHud:move(830, 240) -- Ajusta la posicion del panel HUD cambiando estos valores

function inicializar()
  actualizarExpPorHora()
  mostrarExpPorHora()
  mostrarStamina()
  mostrarNivel()
  mostrarShield()
  mostrarMagicLevel()
end

inicializar()
